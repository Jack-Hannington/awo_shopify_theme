<div class="page-width">
    <table style="width:100%;">
    <thead>
      <tr>
        <th>Image</th>
        <th>Title</th>
        <th>Quantity</th>
        <th>Amount</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {%- for parent_item in cart.items -%}
        {% unless parent_item.properties.Variant == blank %}
          <!-- Parent Product Row -->
          <tr>
            <td><img src="{{ parent_item.image | img_url: 'small' }}" alt="{{ parent_item.product.title }}" /></td>
            <td>{{ parent_item.product.title }}</td>
            <td>
              <input type="number" class="quantity-input" data-key="{{ parent_item.key }}" value="{{ parent_item.quantity }}" min="1" />
            </td>
            <td>{{ parent_item.final_line_price | money }}</td>
            <td>
              <button class="update-quantity" data-key="{{ parent_item.key }}">Update</button>
              <div style="width:20px;" class="remove-item" data-key="{{ parent_item.key }}">
                {% render 'icon-remove' %}
              </div>
            </td>
          </tr>
          
          <!-- Loop through service items for this parent -->
          {%- for service_item in cart.items -%}
            {% if service_item.properties.Parent == parent_item.properties.Variant %}
              <tr>
                <td><img src="{{ service_item.image | img_url: 'small' }}" alt="{{ service_item.product.title }}" /></td>
                <td>-- {{ service_item.product.title }}</td>
                <td>
                  <input type="number" class="quantity-input" data-key="{{ service_item.key }}" value="{{ service_item.quantity }}" min="1" />
                </td>
                <td>{{ service_item.final_line_price | money }}</td>
                <td>
                  <button class="update-quantity" data-key="{{ service_item.key }}">Update</button>
                  <div style="width:20px;" class="remove-item" data-key="{{ service_item.key }}">
                    {% render 'icon-remove' %}
                  </div>
                </td>
              </tr>
            {% endif %}
          {%- endfor -%}
        {% endunless %}
      {%- endfor -%}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="4"><strong>Total</strong></td>
        <td><strong>{{ cart.total_price | money }}</strong></td>
      </tr>
    </tfoot>
  </table>
</div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.update-quantity').forEach(function(button) {
        button.addEventListener('click', function() {
          const key = this.getAttribute('data-key');
          const quantity = this.closest('tr').querySelector('.quantity-input').value;
  
          fetch('/cart/change.js', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify({
              id: key,
              quantity: quantity
            })
          })
          .then(response => response.json())
          .then(cart => {
            // Optionally, refresh the cart UI or display a success message
            console.log(cart);
            location.reload(); // Reload the page to reflect the changes
          })
          .catch(error => console.error('Error:', error));
        });
      });
  
      document.querySelectorAll('.remove-item').forEach(function(button) {
        button.addEventListener('click', function() {
          const key = this.getAttribute('data-key');
  
          fetch('/cart/change.js', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify({
              id: key,
              quantity: 0
            })
          })
          .then(response => response.json())
          .then(cart => {
            // Optionally, refresh the cart UI or display a success message
            console.log(cart);
            location.reload(); // Reload the page to reflect the changes
          })
          .catch(error => console.error('Error:', error));
        });
      });
    });
  </script>
  